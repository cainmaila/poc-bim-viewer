# Use Case Specification: BIM Viewer (v2.0)

## 0. 基本資訊

- **Use Case 名稱**: BIM Viewer
- **目標**: 讓使用者能快速載入 GLB 模型並觀看渲染效果，解決 3D 建模後需要即時驗證的問題。
- **主要使用者**: Web 使用者 (建模人員)
- **使用頻率**: 專案期間頻繁使用
- **性質**: 靜態部署的 POC

## 1. 描述與前置條件

- **簡短描述**: 使用者透過「拖曳」點擊 GLB 模型放入場域，系統具備 IndexedDB 緩存記憶、樹狀導航與自適應平移對焦功能。
- **情境描述**: 建模人員在完成模型後，需確認模型在網頁上的效果（比例、材質、結構）。
- **觸發條件**: 使用者開啟 BIM Viewer 網頁。
- **期望結果**: 系統自動以 45 度等角視角呈現建築全貌。
- **完成定義**: 載入動畫結束且移除全螢幕遮罩，畫面呈現精美視角，使用者可自由操作。

## 2. 流程設計

### 2.1 主流程 (Main Flow) ⭐

1. 使用者進入 BIM Viewer 網頁。
2. **系統回應**: 顯示全螢幕 Loading 轉圈。
3. 載入模型（優先讀取 IndexedDB 緩存，若無則載入系統預設模型）。
4. 渲染完成，移除 Loading 遮罩，顯示左側樹狀選單與 3D 建築。
5. 使用者從本地拖曳新的 GLB 檔案至網頁中。
6. **系統回應**: 顯示「請在此處放開以載入模型」提示層。
7. 使用者放開滑鼠 (Drop)。
8. 系統偵測檔案 (格式與大小 <= 50MB)。
9. 系統解析新模型、替換內容、同步更新緩存（不顯示通知）。
10. 載入結束，攝影機自動對焦 45 度等角全貌。
11. 使用者點擊樹狀結構節點，系統執行 Fly-to 並切換為 X-ray 視覺效果。

### 2.2 替代流程 (Alternative Flows)

- **手動收合側邊欄**: 使用者可隨時隱藏側邊欄以換取最大視圖。
- **單一替換機制**: 每次成功上傳新模型皆會直接覆蓋原有的緩存。

### 2.3 例外流程 (Exception Flows)

- **E1. 模型解析失敗**: 彈出「模型解析失敗」提示，維持原狀。
- **E2. 快取容量不足**: 彈出「容量不足，無法儲存至緩存」提示。
- **E3. 檔案格式錯誤**: 顯示「檔案格式錯誤，請使用 .glb 模型」提示。
- **E4. 模型檔案過大**: 彈出「模型過大，建議處理素材(>50MB)」提示。

## 3. 數據與邏輯需求

- **數據項目**: IndexedDB 緩存之單一 GLB 檔案、模型節點樹數據。
- **視角邏輯**: Fly-to 採平移 (Pan) 導航，方向維持不變，視距根據 Viewport 自適應對焦物件。
- **視覺邏輯**: 支援特定節點突顯 (Normal) 與非選中構件半透明化 (X-ray) 的切換。

## 4. UI/UX 規則

- **畫面初期狀態**: Loading 時隱藏樹狀選單。載入後自動開啟。
- **Dragover 狀態**: 覆蓋層顯示引傳文字。
- **Selected State**: 選中節點正常，其餘半透明。點擊空白處恢復。

## 5. 驗眼條件 (AC)

- **AC-1**: 啟動時必須優先載入緩存模型。
- **AC-2**: 重新整理網頁後應自動載入最後一次載入的模型。
- **AC-3**: 左側樹狀結構必須正確反映當前模型的層級結構。
- **AC-4**: 點擊節點後，攝影機必須「清晰呈現」該物件於畫面中心，且不得被裁切。
- **AC-5**: 點選節點後的 X-ray 效果必須能明確區分目標與其它背景。
- **AC-6**: 檔案超過 50MB 或格式非 GLB 必須被有效攔截並提示。
- **AC-7**: 載入（啟動或替換模型）過程中應有全螢幕 Loading 狀態。
